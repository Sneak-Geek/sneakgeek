platform :ios do
	desc "Fastlane for iOS"
	xcproj = "./ios/app.xcodeproj"
      
	lane :bump_version_number do
	  increment_version_number_in_xcodeproj(
      bump_type: "minor",
      xcodeproj: xcproj
    )
    commit_version_bump(
      message: "Fastlane: auto commit version bump",
      xcodeproj: xcproj, 
      no_verify: true
    )
	end
      
	lane :bump_build_number do
	  increment_build_number(xcodeproj: xcproj)
	  commit_version_bump(
	    message: "Fastlane: auto commit build bump",
	    xcodeproj: xcproj,
	    no_verify: true
	  )
	end
      
	lane :reset_build_number do
	  increment_build_number(xcodeproj: xcproj, build_number: 0)
	  commit_version_bump(
	    message: "Fastlane: auto commit version bump",
	    xcodeproj: xcproj
	  )
	end
      
	lane :archive_staging do
	  # Install pods
	  cocoapods(
      use_bundle_exec: false,
	    clean_install: true,
	    podfile: "./ios/Podfile"
	  )
	  # Setup provisioning profiles and certificates
	  match(
	    type: "adhoc", 
	    app_identifier: "app.sneakgeek.mobile.staging", 
	    username: "huyhoang.pham95@gmail.com", 
	    team_id: "VVPX9A83PB"
	  )
	  # Build
	  gym(
	    workspace: "ios/app.xcworkspace",
	    scheme: "app-staging",
	    configuration: "Release",
	    clean: true,
	    derived_data_path: "ios/build/staging",
	    output_directory: "ios/build/staging",
	    export_method: "ad-hoc",
	    xcargs: "-allowProvisioningUpdates"
	  )
	end

  lane :distribute_staging_app_center do 
    appcenter_upload(
		api_token: ENV["APP_CENTER_API_TOKEN"],
		owner_name: "SneakGeek",
		owner_type: "organization",
		app_name: "sneakgeek",
		file: "ios/build/staging/SneakGeek.ipa"
	)
  end
end